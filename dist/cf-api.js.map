{"version":3,"sources":["../cf-api.js"],"names":["require","config","request","cheerio","options","url","process","env","CUNYfirst_url","headers","jar","getICValues","body","$","load","id","input","children","ICValues","i","length","attribs","name","value","urlProducer","ICStateNum","ICSID","inst","term","urlProducerAllClasses","subject","getAllSections","Promise","resolve","reject","get","error","response","submit_options","classes","idTitle","idTable","section","text","j","classNumber","className","time","room","instructor","dates","status","alt","description","module","exports"],"mappings":"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","file":"cf-api.js","sourcesContent":["require('dotenv').config();\nconst request = require('request');\nconst cheerio = require('cheerio');\n\nlet options = {\n    url: process.env.CUNYfirst_url,\n    headers: {'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/61.0.3163.100 Safari/537.36'},\n    jar: request.jar()\n};\n\nlet getICValues = (body) => {\n    let $ = cheerio.load(body);\n    let id ='#win0divPSHIDDENFIELDS';\n    let input = $(id).children();\n    let ICValues = {};\n\n    for(let i = 0; i < input.length; i++){\n        ICValues[input[i].attribs.name] = input[i].attribs.value;\n    }\n\n    return ICValues;\n};\n\nlet urlProducer = (ICStateNum, ICSID, inst, term) => {\n    return 'https://hrsa.cunyfirst.cuny.edu/psc/cnyhcprd/GUEST/HRMS/c/COMMUNITY_ACCESS.CLASS_SEARCH.GBL?ICAJAX=1&ICNAVTYPEDROPDOWN=0&ICType=Panel&ICElementNum=0&ICStateNum='\n        +ICStateNum+\n        '&ICAction=CLASS_SRCH_WRK2_STRM$35$&ICXPos=0&ICYPos=0&ResponsetoDiffFrame=-1&TargetFrameName=None&FacetPath=None&ICFocus&ICSaveWarningFilter=0&ICChanged=-1&ICAutoSave=0&ICResubmit=0&ICSID='\n        +ICSID+\n        '=&ICActionPrompt=false&ICBcDomData=undefined&ICFind&ICAddCount&ICAPPCLSDATA&CLASS_SRCH_WRK2_INSTITUTION$31$='\n        +inst+\n        '&CLASS_SRCH_WRK2_STRM$35$='\n        +term\n};\n\nlet urlProducerAllClasses = (ICStateNum, ICSID, term, subject) => {\n    return 'https://hrsa.cunyfirst.cuny.edu/psc/cnyhcprd/GUEST/HRMS/c/COMMUNITY_ACCESS.CLASS_SEARCH.GBL?ICAJAX=1&ICNAVTYPEDROPDOWN=0&ICType=Panel&ICElementNum=0&ICStateNum='\n        +ICStateNum+\n        '&ICAction=CLASS_SRCH_WRK2_SSR_PB_CLASS_SRCH&ICXPos=0&ICYPos=0&ResponsetoDiffFrame=-1&TargetFrameName=None&FacetPath=None&ICFocus&ICSaveWarningFilter=0&ICChanged=-1&ICAutoSave=0&ICResubmit=0&ICSID='\n        +ICSID+\n        '=&ICActionPrompt=false&ICBcDomData=undefined&ICFind&ICAddCount&ICAPPCLSDATA&CLASS_SRCH_WRK2_STRM$35$='\n        +term+\n        '&SSR_CLSRCH_WRK_SUBJECT_SRCH$0='\n        +subject+\n        '&SSR_CLSRCH_WRK_SSR_EXACT_MATCH1$1=G&SSR_CLSRCH_WRK_CATALOG_NBR$1=0&SSR_CLSRCH_WRK_SSR_OPEN_ONLY$chk$5=N'\n};\n\nlet getAllSections = (inst, term, subject) => {\n    return new Promise((resolve, reject) => {\n        request.get(options, function(error, response, body){\n            if(error){\n                reject('CUNYfirst is currently offline.');\n            }\n\n            let ICValues = getICValues(body);\n\n            let ICStateNum = ICValues['ICStateNum'];\n            let ICSID = ICValues['ICSID'];\n\n            let submit_options = {\n                url: urlProducer(ICStateNum, ICSID, inst, term),\n                headers: {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/46.0.2490.80 Safari/537.36'},\n                jar: options.jar\n            };\n\n            request.get(submit_options, function(error, response, body){\n                submit_options['url'] = urlProducerAllClasses(++ICStateNum, ICSID, term, subject);\n                request.get(submit_options, function(error, response, body) {\n                    if(error){\n                        reject('CUNYfirst is currently offline.');\n                    }\n\n                    let classes = {};\n                    let $ = cheerio.load(body);\n\n                    let i = 0;\n                    let idTitle = `#win0divSSR_CLSRSLT_WRK_GROUPBOX2GP\\\\$${i}`;\n                    let idTable = `#ACE_\\\\$ICField48\\\\$${i}`;\n\n                    let section = 0;\n\n                    while ($(idTitle).text() !== '') {\n                        classes[$(idTitle).text()] = {};\n\n                        for(let j = 0; j < ($(idTable).children()[0].children.length)/4; j++) {\n                            let classNumber = $(`#MTG_CLASS_NBR\\\\$${section}`).text();\n                            let className = $(`#MTG_CLASSNAME\\\\$${section}`).text();\n                            let time = $(`#MTG_DAYTIME\\\\$${section}`).text();\n                            let room = $(`#MTG_ROOM\\\\$${section}`).text();\n                            let instructor = $(`#MTG_INSTR\\\\$${section}`).text();\n                            let dates = $(`#MTG_TOPIC\\\\$${section}`).text();\n                            let status = $(`#win0divDERIVED_CLSRCH_SSR_STATUS_LONG\\\\$${section}`).children()[0].children[3].attribs.alt;\n                            let description = $(`#DERIVED_CLSRCH_DESCRLONG\\\\$${section}`).text();\n\n                            classes[classNumber] = {};\n                            classes[classNumber]['Class'] = classNumber;\n                            classes[classNumber]['Section'] = className;\n                            classes[classNumber]['Days & Time'] = time;\n                            classes[classNumber]['Room'] = room;\n                            classes[classNumber]['Instructor'] = instructor;\n                            classes[classNumber]['Dates'] = dates;\n                            classes[classNumber]['Status'] = status;\n                            classes[classNumber]['Description'] = description;\n                            classes[classNumber]['Topic'] = $(idTitle).text();\n\n                            section++;\n                        }\n\n                        i++;\n                        idTitle = `#win0divSSR_CLSRSLT_WRK_GROUPBOX2GP\\\\$${i}`;\n                        idTable = `#ACE_\\\\$ICField48\\\\$${i}`;\n                    }\n\n                    resolve(classes);\n                })\n            })\n        })\n    })\n};\n\nmodule.exports = {\n    getAllSections\n};"]}