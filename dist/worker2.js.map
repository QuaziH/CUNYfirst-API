{"version":3,"sources":["../worker2.js"],"names":["request","require","HTML","cheerio","options","url","headers","jar","getOptionsFromDropdown","body","id","callback","$","load","test","children","values","i","length","data","attribs","value","urlProducer","ICStateNum","ICSID","inst","session","urlProducerClasses","subject","term","get","error","response","console","log","key","split","substring","submit_options","start","end","institutions","_"],"mappings":"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","file":"worker2.js","sourcesContent":["const request = require('request');\nconst HTML = require('html-parse-stringify');\nconst cheerio = require('cheerio');\n\nlet options = {\n    url: 'https://hrsa.cunyfirst.cuny.edu/psc/cnyhcprd/GUEST/HRMS/c/COMMUNITY_ACCESS.CLASS_SEARCH.GBL',\n    headers: {'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/61.0.3163.100 Safari/537.36'},\n    jar: request.jar()\n};\n\nlet getOptionsFromDropdown = (body, id, callback) => {\n    let $ = cheerio.load(body);\n    let test = $(id).children();\n\n    let values = {};\n\n    for(let i = 1; i < test.length; i++){\n        values[test[i].children[0].data] = test[i].attribs.value;\n    }\n\n    callback(values);\n};\n\nlet urlProducer = (ICStateNum, ICSID, inst, session) => {\n    return 'https://hrsa.cunyfirst.cuny.edu/psc/cnyhcprd/GUEST/HRMS/c/COMMUNITY_ACCESS.CLASS_SEARCH.GBL?ICAJAX=1&ICNAVTYPEDROPDOWN=0&ICType=Panel&ICElementNum=0&ICStateNum='\n        +ICStateNum+\n        '&ICAction=CLASS_SRCH_WRK2_STRM$35$&ICXPos=0&ICYPos=0&ResponsetoDiffFrame=-1&TargetFrameName=None&FacetPath=None&ICFocus&ICSaveWarningFilter=0&ICChanged=-1&ICAutoSave=0&ICResubmit=0&ICSID='\n        +ICSID+\n        '=&ICActionPrompt=false&ICBcDomData=undefined&ICFind&ICAddCount&ICAPPCLSDATA&CLASS_SRCH_WRK2_INSTITUTION$31$='\n        +inst+\n        '&CLASS_SRCH_WRK2_STRM$35$='\n        +session\n};\n\nlet urlProducerClasses = (ICStateNum, ICSID, session, subject) => {\n    return 'https://hrsa.cunyfirst.cuny.edu/psc/cnyhcprd/GUEST/HRMS/c/COMMUNITY_ACCESS.CLASS_SEARCH.GBL?ICAJAX=1&ICNAVTYPEDROPDOWN=0&ICType=Panel&ICElementNum=0&ICStateNum='\n        +ICStateNum+\n        '&ICAction=CLASS_SRCH_WRK2_SSR_PB_CLASS_SRCH&ICXPos=0&ICYPos=0&ResponsetoDiffFrame=-1&TargetFrameName=None&FacetPath=None&ICFocus&ICSaveWarningFilter=0&ICChanged=-1&ICAutoSave=0&ICResubmit=0&ICSID='\n        +ICSID+\n        '=&ICActionPrompt=false&ICBcDomData=undefined&ICFind&ICAddCount&ICAPPCLSDATA&CLASS_SRCH_WRK2_STRM$35$='\n        +session+\n        '&SSR_CLSRCH_WRK_SUBJECT_SRCH$0='\n        +subject+\n        '&SSR_CLSRCH_WRK_SSR_EXACT_MATCH1$1=G&SSR_CLSRCH_WRK_CATALOG_NBR$1=0&SSR_CLSRCH_WRK_SSR_OPEN_ONLY$chk$5=N'\n};\n\nlet term = (inst, callback) => {\n    request.get(options, function(error, response, body){\n        if(error){\n            console.log('CUNYfirst is currently offline.');\n        }\n\n        // console.log(body);\n        // let start = \"<DIV class=\\'x\\'  id=\\'win0divPSHIDDENFIELDS\\'\";\n        // let end = \"</DIV>\";\n        // getICValues(body, start, end, callback);\n\n        let key = body.split(\"id=\\'ICSID\\' value=\\'\")[1].substring(0, 44);\n        let ICStateNum = body.split(\"id=\\'ICStateNum\\' value=\\'\")[1].split(\"\\'\")[0];\n        let submit_options = {\n            url: urlProducer(ICStateNum, key, inst, ''),\n            headers: {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/46.0.2490.80 Safari/537.36'},\n            jar: options.jar\n        };\n        request.get(submit_options, function(error, response, body){\n            let start = \"<select name=\\'CLASS_SRCH_WRK2_STRM$35$\\'\";\n            let end = \"</select>\";\n            getOptionsFromDropdown(body, start, end, callback)\n        })\n    })\n};\n\nlet institutions = (callback) => {\n    request.get(options, function(error, response, body){\n        if(error){\n            console.log('CUNYfirst is currently offline.');\n        }\n\n        let id = `#CLASS_SRCH_WRK2_INSTITUTION\\\\$31\\\\$`;\n        getOptionsFromDropdown(body, id, callback);\n    })\n};\n\n// term('QNS01', function(r){\n//     console.log(r);\n// });\n\ninstitutions(function(_){\n    // term('QNS01', function(_){\n        console.log(_);\n    // });\n});"]}