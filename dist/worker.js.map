{"version":3,"sources":["../worker.js"],"names":["request","require","cheerio","options","url","headers","jar","getOptionsFromDropdown","body","id","callback","$","load","children","values","i","length","data","attribs","value","getICValues","input","ICValues","name","urlProducer","ICStateNum","ICSID","inst","session","urlProducerClasses","subject","section","term","get","error","response","console","log","submit_options","classes","institutions"],"mappings":"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","file":"worker.js","sourcesContent":["const request = require('request');\nconst cheerio = require('cheerio');\n\nlet options = {\n    url: 'https://hrsa.cunyfirst.cuny.edu/psc/cnyhcprd/GUEST/HRMS/c/COMMUNITY_ACCESS.CLASS_SEARCH.GBL',\n    headers: {'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/61.0.3163.100 Safari/537.36'},\n    jar: request.jar()\n};\n\nlet getOptionsFromDropdown = (body, id, callback) => {\n    let $ = cheerio.load(body);\n    let options = $(id).children();\n    let values = {};\n\n    for(let i = 1; i < options.length; i++){\n        values[options[i].children[0].data] = options[i].attribs.value;\n    }\n\n    callback(values);\n};\n\nlet getICValues = (body) => {\n    let $ = cheerio.load(body);\n    let id ='#win0divPSHIDDENFIELDS';\n    let input = $(id).children();\n    let ICValues = {};\n\n    for(let i = 0; i < input.length; i++){\n        ICValues[input[i].attribs.name] = input[i].attribs.value;\n    }\n\n    return ICValues;\n};\n\nlet urlProducer = (ICStateNum, ICSID, inst, session) => {\n    return 'https://hrsa.cunyfirst.cuny.edu/psc/cnyhcprd/GUEST/HRMS/c/COMMUNITY_ACCESS.CLASS_SEARCH.GBL?ICAJAX=1&ICNAVTYPEDROPDOWN=0&ICType=Panel&ICElementNum=0&ICStateNum='\n        +ICStateNum+\n        '&ICAction=CLASS_SRCH_WRK2_STRM$35$&ICXPos=0&ICYPos=0&ResponsetoDiffFrame=-1&TargetFrameName=None&FacetPath=None&ICFocus&ICSaveWarningFilter=0&ICChanged=-1&ICAutoSave=0&ICResubmit=0&ICSID='\n        +ICSID+\n        '=&ICActionPrompt=false&ICBcDomData=undefined&ICFind&ICAddCount&ICAPPCLSDATA&CLASS_SRCH_WRK2_INSTITUTION$31$='\n        +inst+\n        '&CLASS_SRCH_WRK2_STRM$35$='\n        +session\n};\n\nlet urlProducerClasses = (ICStateNum, ICSID, session, subject) => {\n    return 'https://hrsa.cunyfirst.cuny.edu/psc/cnyhcprd/GUEST/HRMS/c/COMMUNITY_ACCESS.CLASS_SEARCH.GBL?ICAJAX=1&ICNAVTYPEDROPDOWN=0&ICType=Panel&ICElementNum=0&ICStateNum='\n        +ICStateNum+\n        '&ICAction=CLASS_SRCH_WRK2_SSR_PB_CLASS_SRCH&ICXPos=0&ICYPos=0&ResponsetoDiffFrame=-1&TargetFrameName=None&FacetPath=None&ICFocus&ICSaveWarningFilter=0&ICChanged=-1&ICAutoSave=0&ICResubmit=0&ICSID='\n        +ICSID+\n        '=&ICActionPrompt=false&ICBcDomData=undefined&ICFind&ICAddCount&ICAPPCLSDATA&CLASS_SRCH_WRK2_STRM$35$='\n        +session+\n        '&SSR_CLSRCH_WRK_SUBJECT_SRCH$0='\n        +subject+\n        '&SSR_CLSRCH_WRK_SSR_EXACT_MATCH1$1=G&SSR_CLSRCH_WRK_CATALOG_NBR$1=0&SSR_CLSRCH_WRK_SSR_OPEN_ONLY$chk$5=N'\n};\n\nlet section = (inst, term, subject, callback) => {\n    request.get(options, function(error, response, body){\n        if(error){\n            console.log('CUNYfirst is currently offline.');\n        }\n\n        let ICValues = getICValues(body);\n\n        let ICStateNum = ICValues['ICStateNum'];\n        let ICSID = ICValues['ICSID'];\n\n        let submit_options = {\n            url: urlProducer(ICStateNum, ICSID, inst, term),\n            headers: {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/46.0.2490.80 Safari/537.36'},\n            jar: options.jar\n        };\n\n        request.get(submit_options, function(error, response, body){\n            submit_options['url'] = urlProducerClasses(++ICStateNum, ICSID, term, subject);\n            request.get(submit_options, function(error, response, body){\n                let classes = {};\n                let $ = cheerio.load(body);\n                console.log($('#ACE_\\\\$ICField\\\\$4\\\\$\\\\$0').children().length);\n            })\n        })\n\n    })\n};\n\nlet subject = (inst, term, callback) => {\n    request.get(options, function(error, response, body){\n        if(error){\n            console.log('CUNYfirst is currently offline.');\n        }\n\n        let ICValues = getICValues(body);\n\n        let ICStateNum = ICValues['ICStateNum'];\n        let ICSID = ICValues['ICSID'];\n\n        let submit_options = {\n            url: urlProducer(ICStateNum, ICSID, inst, term),\n            headers: {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/46.0.2490.80 Safari/537.36'},\n            jar: options.jar\n        };\n\n        request.get(submit_options, function(error, response, body){\n            let id = `#SSR_CLSRCH_WRK_SUBJECT_SRCH\\\\$0`;\n            getOptionsFromDropdown(body, id, callback);\n        })\n    })\n};\n\nlet term = (inst, callback) => {\n    request.get(options, function(error, response, body){\n        if(error){\n            console.log('CUNYfirst is currently offline.');\n        }\n\n        let ICValues = getICValues(body);\n\n        let ICStateNum = ICValues['ICStateNum'];\n        let ICSID = ICValues['ICSID'];\n\n        let submit_options = {\n            url: urlProducer(ICStateNum, ICSID, inst, ''),\n            headers: {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/46.0.2490.80 Safari/537.36'},\n            jar: options.jar\n        };\n\n        request.get(submit_options, function(error, response, body){\n            let id = `#CLASS_SRCH_WRK2_STRM\\\\$35\\\\$`;\n            getOptionsFromDropdown(body, id, callback);\n        })\n    })\n};\n\nlet institutions = (callback) => {\n    request.get(options, function(error, response, body){\n        if(error){\n            console.log('CUNYfirst is currently offline.');\n        }\n\n        let id = `#CLASS_SRCH_WRK2_INSTITUTION\\\\$31\\\\$`;\n        getOptionsFromDropdown(body, id, callback);\n    })\n};\n\nsection('QNS01', '1182', 'CSCI', function(){\n    console.log();\n});\n\n// subject('QNS01', '1182', function(r){\n//     console.log(r);\n// });\n\n// term('QNS01', function(r){\n//     console.log(r);\n// });\n\n// institutions(function(r){\n//     console.log(r);\n// });"]}